# Kubernetes ConfigMap for WJP ANALYSER
# ======================================

apiVersion: v1
kind: ConfigMap
metadata:
  name: wjp-config
  namespace: wjp-analyser
data:
  unified_config.yaml: |
    # WJP ANALYSER - Unified Configuration
    database:
      type: "postgresql"
      host: "postgres-service"
      port: 5432
      pool_size: 10
      max_overflow: 20
      echo: false
    
    redis:
      host: "redis-service"
      port: 6379
      db: 0
      max_connections: 10
    
    security:
      session_timeout: 3600
      password_min_length: 8
      password_require_special: true
      rate_limit_enabled: true
      rate_limit_per_minute: 60
      rate_limit_per_hour: 1000
      rate_limit_burst: 10
      max_upload_size: 33554432
      allowed_extensions:
        - "dxf"
        - "jpg"
        - "jpeg"
        - "png"
        - "bmp"
        - "tiff"
    
    server:
      host: "0.0.0.0"
      port: 8000
      debug: false
      threaded: true
      processes: 1
    
    logging:
      level: "INFO"
      format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
      file_rotation_enabled: true
      max_bytes: 10485760
      backup_count: 5
      console_output: true
      file_output: true
    
    performance:
      cache_enabled: true
      cache_size: 100
      cache_ttl: 3600
      max_workers: 4
      timeout: 300
    
    features:
      ai_analysis: true
      image_conversion: true
      nesting: true
      cost_estimation: true
      guided_mode: true
      batch_processing: true
      authentication: true
      rate_limiting: true
    
    defaults:
      material: "steel"
      thickness: 6.0
      kerf: 1.1
      cutting_speed: 1200.0
      cost_per_meter: 50.0
      sheet_width: 3000.0
      sheet_height: 1500.0
      spacing: 10.0
    
    image_processing:
      edge_threshold: 0.33
      min_contour_area: 100
      simplify_tolerance: 0.02
      blur_kernel_size: 5
      canny_low: 50
      canny_high: 150
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: prometheus-config
  namespace: wjp-analyser
data:
  prometheus.yml: |
    global:
      scrape_interval: 15s
      evaluation_interval: 15s
    
    rule_files:
      - "rules/*.yml"
    
    scrape_configs:
      - job_name: 'prometheus'
        static_configs:
          - targets: ['localhost:9090']
      
      - job_name: 'wjp-web'
        static_configs:
          - targets: ['wjp-web-service:8000']
        metrics_path: '/metrics'
        scrape_interval: 30s
      
      - job_name: 'wjp-worker'
        static_configs:
          - targets: ['wjp-worker-service:5555']
        metrics_path: '/metrics'
        scrape_interval: 30s
      
      - job_name: 'postgres'
        static_configs:
          - targets: ['postgres-service:5432']
        scrape_interval: 30s
      
      - job_name: 'redis'
        static_configs:
          - targets: ['redis-service:6379']
        scrape_interval: 30s
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-datasources
  namespace: wjp-analyser
data:
  datasources.yaml: |
    apiVersion: 1
    datasources:
      - name: Prometheus
        type: prometheus
        access: proxy
        url: http://prometheus-service:9090
        isDefault: true
        editable: true
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboards
  namespace: wjp-analyser
data:
  dashboard-providers.yaml: |
    apiVersion: 1
    providers:
      - name: 'default'
        orgId: 1
        folder: ''
        type: file
        disableDeletion: false
        updateIntervalSeconds: 10
        allowUiUpdates: true
        options:
          path: /var/lib/grafana/dashboards
